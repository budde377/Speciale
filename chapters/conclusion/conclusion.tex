%First summary then overall conclusion


In this thesis, a corpus consisting of some of the most popular PHP frameworks have been run and subsequently dynamically analysed, revealing that almost all PHP arrays can mostly be categorized into two types: lists and maps, both acyclic. Cases outside those categories have been shown to benefit from being rewritten to fit the categories, with a clearer intention and higher maintainability as the result. Furthermore, it was shown that operations normally associated with lists, e.g.\ \texttt{array\_pop}, \texttt{array\_push}, \texttt{array\_shift}, are used almost exclusively on array-lists. Running these programs relies on the test-suites defined by the designers of the respective frameworks, which reduces the task of analysing the corpus to adding a logging feature to the interpreter and inspecting the output. While this strategy relies on the quality of the test-suites, the size of the log-files generated (41 MB to 13 GB) and the popularity of the programs, assure us that the coverage achieved is better than anything we could have designed in a reasonable amount of time. The categories and operation-usage identified agrees with the initial hypothesis, that PHP arrays are subject to specific use-patterns. 


The results of the dynamic analysis motivated the design of a classic inter-procedural data-flow analysis using the monotone framework. In this respect, the main contributions are the definition of a subset language of PHP, a method for generating control-flow graphs, a context sensitive lattice expressing abstract states, and a set of transfer functions aiming to be sound. This analysis has been integrated into one of the most popular IDEs for PHP programming, utilizing the AST generated by the environment and allowing instantaneous annotation of code. 

Due to the lack of specification and large number of features, the analysis is neither proven sound, optimized for fast execution, nor executed on large programs. It has however successfully annotated suspicious cross-use of the array patterns on code discovered in the corpus in a reasonable amount of time. These cases were chosen by inspecting arrays that according the dynamic analysis either were uncategorizable (i.e.\ neither lists or maps) or maps on which list operations were performed. Some modifications have been proposed as a result of the case study described in chapter \ref{ch:evaluation}, i.e.\ a new array lattice and more precise error-reporting. It is expected that further evaluation will lead to more of such improvements.

This analysis serves as a stepping stone to the construction of a full-fledged static analysis of programs written in the obscure language that is PHP. By building this analysis on basic static analysis principles, other techniques for achieving e.g.\ dynamic dispatch should be relatively easy to apply. The analysis should serve as a tool for PHP developers, integrated in their development environment, allowing them to discover errors before the programs are published. 




%The purpose of the dynamic analysis was to evaluate our hypothesis stating that arrays in a given program can be categorized as either list, map, or object, and once categorized, will stay in the category throughout multiple executions of that program. The results of the analysis supports this hypothesis by showing that arrays generally keep the same type. Furthermore, the usage of array operations normally associated with lists, proved almost exclusive for arrays categorized as lists. This information should used to define unexpected behaviour reported by the static analysis, e.g. reporting \texttt{array\_pop} preformed on a map. 

%The initial definitions categorized arrays as objects based on the type of the values. In the analysis however, a significant number of arrays turned out to be lists with different type values, defining them as objects. Operations on these objects were often list-operations, which indicates that categorizing based on value type might not be a meaningful strategy. It can be considered if the object type is providing enough significant information in itself, or should be consumed by the definitions of maps and lists, i.e. letting maps and lists allow values of different type.

%Almost every framework in the corpus contains cyclic arrays however these are nearly exclusively uses of the superglobal \texttt{\$GLOBALS}. Manipulating the global variables as a method for passing information seems suspicious and indicates poor program design, but reminds us that every PHP program has at least one cyclic array which must be handled in an sound manner. No creation of cyclic arrays has been detected in the program, which follows our hypothesis, that the developer will generally not utilize the more advanced array structures. 
 
 
 
%The widely used array data structure in PHP has very few restrictions making it difficult to reason about with program analysis. 

%This thesis will identify possible use-patterns for arrays in PHP 
%and how to detect them in static analysis. 
%An \emph{interprocedural data-flow type-analysis} is proposed to detect suspicious cross-use of the identified patterns.
%And consequently evaluated.
